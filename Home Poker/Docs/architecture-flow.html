<!DOCTYPE html>
<html>
<head>
<title>architecture-flow.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="home-poker---%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D0%B8-flow-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">Home Poker - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ Flow –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h1>
<h2 id="%F0%9F%93%B1-%D0%BE%D0%B1%D0%B7%D0%BE%D1%80-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">üì± –û–±–∑–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
<p><strong>Home Poker</strong> - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–∏–º–∏ –ø–æ–∫–µ—Ä–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:</p>
<ul>
<li>–£—á—ë—Ç –∏–≥—Ä–æ–∫–æ–≤, buy-in, cash-out, rebuy</li>
<li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–∫–æ–º —Å–µ—Å—Å–∏–∏</li>
<li>–†–∞—Å—á—ë—Ç settlement (–∫—Ç–æ –∫–æ–º—É –¥–æ–ª–∂–µ–Ω)</li>
<li>–¢–∞–π–º–µ—Ä —Ç—É—Ä–Ω–∏—Ä–∞ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –±–ª–∞–π–Ω–¥–∞–º–∏</li>
<li>–£—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤</li>
</ul>
<hr>
<h2 id="%F0%9F%97%BA%EF%B8%8F-%D0%BD%D0%B0%D0%B2%D0%B8%D0%B3%D0%B0%D1%86%D0%B8%D1%8F-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">üó∫Ô∏è –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    App[HomePokerApp] --> Main[MainView - TabView]

    %% Tab 1: –°–µ—Å—Å–∏–∏
    Main --> Tab1[Tab 1: SessionListView]
    Main --> Tab2[Tab 2: TimerManagerView]

    %% SessionListView
    Tab1 -->|NavigationLink| Settings[SettingsView]
    Tab1 -->|sheet| NewSession[NewSessionSheet]
    Tab1 -->|NavigationLink| Detail[SessionDetailView]

    %% SessionDetailView sheets
    Detail -->|sheet| AddPlayer[AddPlayerSheet]
    Detail -->|sheet| AddExpense[AddExpenseSheet]
    Detail -->|sheet| BlindsEditor[BlindsEditorSheet]
    Detail -->|sheet| PlayerCashOut[PlayerCashOutSheet]
    Detail -->|sheet| PlayerRebuy[RebuyPlayerSheet]
    Detail -->|sheet| PlayerAddOn[PlayerAddOnSheet]

    %% SessionBankView
    Detail -->|NavigationLink| Bank[SessionBankView]
    Bank -->|sheet| BankDeposit[SessionBankTransactionSheet - –í–Ω–µ—Å–µ–Ω–∏–µ]
    Bank -->|sheet| BankWithdraw[SessionBankTransactionSheet - –í—ã–¥–∞—á–∞]
    Bank -->|sheet| Settlement[SettlementView]

    %% Timer flow
    Tab2 -->|showConfigForm=true| TemplatePicker[TemplatePickerView]
    Tab2 -->|showConfigForm=false| Timer[TimerView]
    TemplatePicker -->|NavigationDestination| TemplateEditor[TemplateEditorView]
    TemplateEditor -->|sheet| AddLevel[AddLevelSheet]
</div></code></pre>
<hr>
<h2 id="%F0%9F%97%84%EF%B8%8F-%D1%81%D1%85%D0%B5%D0%BC%D0%B0-%D0%B1%D0%B0%D0%B7%D1%8B-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-swiftdata">üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SwiftData)</h2>
<pre><code class="language-mermaid"><div class="mermaid">erDiagram
    Session ||--o{ Player : "cascade delete"
    Session ||--o| SessionBank : "cascade delete"
    Session ||--o{ Expense : "cascade delete"

    Player ||--o{ PlayerTransaction : "cascade delete"

    SessionBank ||--o{ SessionBankTransaction : "cascade delete"
    SessionBank }o--|| Player : "manager (nullify)"

    SessionBankTransaction }o--o| Player : "player (nullify)"
    Expense }o--o| Player : "payer (nullify)"

    Session {
        UUID id PK
        Date startTime
        String sessionTitle
        String location
        GameType gameType
        SessionStatus status
        Int smallBlind
        Int bigBlind
        Int ante
    }

    Player {
        UUID id PK
        String name
        Bool inGame
        Bool getsRakeback
        Int rakeback
    }

    PlayerTransaction {
        UUID id PK
        Date timestamp
        TransactionType type
        Int amount
    }

    SessionBank {
        UUID id PK
        Date createdAt
        Bool isClosed
        Date closedAt
        Int expectedTotal
    }

    SessionBankTransaction {
        UUID id PK
        Date createdAt
        Int amount
        SessionBankTransactionType type
        String note
    }

    Expense {
        UUID id PK
        Int amount
        String note
        Date createdAt
    }
</div></code></pre>
<h3 id="%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%B2%D1%8F%D0%B7%D0%B5%D0%B9">–û–ø–∏—Å–∞–Ω–∏–µ —Å–≤—è–∑–µ–π:</h3>
<ul>
<li><strong>Session ‚Üí Players</strong>: Cascade delete - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∏–≥—Ä–æ–∫–∏</li>
<li><strong>Session ‚Üí SessionBank</strong>: Cascade delete - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –±–∞–Ω–∫</li>
<li><strong>Session ‚Üí Expenses</strong>: Cascade delete - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Ä–∞—Å—Ö–æ–¥—ã</li>
<li><strong>Player ‚Üí PlayerTransactions</strong>: Cascade delete - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ —É–¥–∞–ª—è—é—Ç—Å—è –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</li>
<li><strong>SessionBank ‚Üí SessionBankTransactions</strong>: Cascade delete - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–∞–Ω–∫–∞ —É–¥–∞–ª—è—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</li>
<li><strong>SessionBank ‚Üí Player (manager)</strong>: Nullify - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ –ø–æ–ª–µ manager —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è nil</li>
<li><strong>SessionBankTransaction ‚Üí Player</strong>: Nullify - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ —Å–≤—è–∑—å –æ–±–Ω—É–ª—è–µ—Ç—Å—è</li>
<li><strong>Expense ‚Üí Player (payer)</strong>: Nullify - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ –ø–æ–ª–µ payer —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è nil</li>
</ul>
<hr>
<h2 id="%F0%9F%8F%97%EF%B8%8F-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D1%81%D0%BB%D0%BE%D1%91%D0%B2">üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–æ—ë–≤</h2>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "VIEW LAYER"
        V1[SessionListView]
        V2[SessionDetailView]
        V3[SessionBankView]
        V4[TimerView]
        V5[SettlementView]
    end

    subgraph "VIEWMODEL LAYER"
        VM1[SessionDetailViewModel]
        VM2[TimerViewModel]
        VM3[TemplateViewModel]
        VM4[SettlementViewModel]
    end

    subgraph "SERVICE LAYER"
        S1[SessionService]
        S2[SessionTimerService]
        S3[TemplateService]
        S4[SettlementService]
    end

    subgraph "REPOSITORY LAYER"
        R1[SwiftDataSessionsRepository]
    end

    subgraph "DATA LAYER"
        DB[(SwiftData ModelContainer)]
        M1[Model Session]
        M2[Model Player]
        M3[Model SessionBank]
    end

    V2 --> VM1
    V4 --> VM2
    V5 --> VM4

    VM1 --> S1
    VM2 --> S2
    VM3 --> S3
    VM4 --> S4

    V1 --> R1
    S1 --> DB
    S4 --> DB
    R1 --> DB

    DB --> M1
    DB --> M2
    DB --> M3
</div></code></pre>
<h3 id="%D0%BF%D1%80%D0%B8%D0%BD%D1%86%D0%B8%D0%BF%D1%8B-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D1%8B">–ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:</h3>
<ol>
<li><strong>View Layer</strong> - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ UI, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞</li>
<li><strong>ViewModel Layer</strong> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ —Å–µ—Ä–≤–∏—Å–∞–º</li>
<li><strong>Service Layer</strong> - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –º–æ–¥–µ–ª—è–º–∏</li>
<li><strong>Repository Layer</strong> - –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º</li>
<li><strong>Data Layer</strong> - SwiftData –º–æ–¥–µ–ª–∏ –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</li>
</ol>
<hr>
<h2 id="%F0%9F%93%82-%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D1%84%D0%B8%D1%87">üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏—á</h2>
<h3 id="session-feature"><strong>Session Feature</strong></h3>
<ul>
<li><strong>Views</strong>:
<ul>
<li><code>SessionListView</code> - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π</li>
<li><code>SessionDetailView</code> - –¥–µ—Ç–∞–ª–∏ —Å–µ—Å—Å–∏–∏ —Å –∏–≥—Ä–æ–∫–∞–º–∏</li>
<li><code>SessionBankView</code> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–∫–æ–º</li>
<li><code>ExpenseDetails</code> - –¥–µ—Ç–∞–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</li>
</ul>
</li>
<li><strong>Subviews</strong>:
<ul>
<li><code>SessionInfoSection</code>, <code>BankStatsSection</code>, <code>PlayerList</code>, <code>PlayerRow</code>, <code>PlayerTransactionsView</code></li>
</ul>
</li>
<li><strong>Sheets</strong>:
<ul>
<li><code>NewSessionSheet</code>, <code>AddPlayerSheet</code>, <code>AddExpenseSheet</code>, <code>BlindsEditorSheet</code></li>
<li><code>PlayerCashOutSheet</code>, <code>RebuyPlayerSheet</code>, <code>PlayerAddOnSheet</code></li>
<li><code>SessionBankTransactionSheet</code></li>
</ul>
</li>
<li><strong>ViewModel</strong>: <code>SessionDetailViewModel</code></li>
<li><strong>Service</strong>: <code>SessionService</code></li>
<li><strong>Models</strong>: <code>Session</code>, <code>Player</code>, <code>PlayerTransaction</code>, <code>SessionBank</code>, <code>SessionBankTransaction</code>, <code>Expense</code></li>
</ul>
<h3 id="timer-feature"><strong>Timer Feature</strong></h3>
<ul>
<li><strong>Views</strong>:
<ul>
<li><code>TimerManagerView</code> - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–π–º–µ—Ä–∞</li>
<li><code>TimerView</code> - –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä</li>
<li><code>TemplatePickerView</code> - –≤—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞</li>
<li><code>TemplateEditorView</code> - —Ä–µ–¥–∞–∫—Ç–æ—Ä —à–∞–±–ª–æ–Ω–∞</li>
</ul>
</li>
<li><strong>Subviews</strong>:
<ul>
<li><code>TimerLevelCard</code>, <code>TimerControlsPanel</code>, <code>NextLevelPreview</code>, <code>LevelsListView</code></li>
<li><code>LevelEditView</code>, <code>AddLevelSheet</code></li>
</ul>
</li>
<li><strong>ViewModels</strong>: <code>TimerViewModel</code>, <code>TemplateViewModel</code></li>
<li><strong>Services</strong>: <code>SessionTimerService</code>, <code>TemplateService</code></li>
<li><strong>Models</strong>: <code>TournamentTemplate</code>, <code>BlindLevel</code>, <code>LevelItem</code>, <code>BreakInfo</code> (–Ω–µ SwiftData, Codable)</li>
</ul>
<h3 id="settlement-feature"><strong>Settlement Feature</strong></h3>
<ul>
<li><strong>Views</strong>: <code>SettlementView</code></li>
<li><strong>ViewModel</strong>: <code>SettlementViewModel</code></li>
<li><strong>Service</strong>: <code>SettlementService</code></li>
</ul>
<h3 id="settings-feature"><strong>Settings Feature</strong></h3>
<ul>
<li><strong>Views</strong>: <code>SettingsView</code></li>
</ul>
<hr>
<h2 id="%F0%9F%94%84-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B-data-flow">üîÑ –ü—Ä–∏–º–µ—Ä—ã Data Flow</h2>
<h3 id="%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80-1-%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B8%D0%B3%D1%80%D0%BE%D0%BA%D0%B0">–ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// 1. VIEW LAYER</span>
<span class="hljs-comment">// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ SessionDetailView –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞"</span>
<span class="hljs-comment">// –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è sheet AddPlayerSheet</span>
<span class="hljs-comment">// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: –∏–º—è "–ò–≤–∞–Ω", buy-in 1000‚ÇΩ</span>

<span class="hljs-comment">// 2. VIEWMODEL LAYER</span>
sessionDetailViewModel.addPlayer(name: <span class="hljs-string">"–ò–≤–∞–Ω"</span>, buyIn: <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 3. SERVICE LAYER</span>
sessionService.addPlayer(
    to: session,
    name: <span class="hljs-string">"–ò–≤–∞–Ω"</span>,
    buyIn: <span class="hljs-number">1000</span>,
    context: modelContext
)

<span class="hljs-comment">// –í–Ω—É—Ç—Ä–∏ SessionService:</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addPlayer</span><span class="hljs-params">(to session: Session, name: String, buyIn: Int, context: ModelContext)</span></span> {
    <span class="hljs-comment">// –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</span>
    <span class="hljs-keyword">let</span> player = <span class="hljs-type">Player</span>(name: name)

    <span class="hljs-comment">// –°–æ–∑–¥–∞—ë–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é buy-in</span>
    <span class="hljs-keyword">let</span> transaction = <span class="hljs-type">PlayerTransaction</span>(
        timestamp: <span class="hljs-type">Date</span>(),
        type: .buyIn,
        amount: buyIn
    )

    <span class="hljs-comment">// –°–≤—è–∑—ã–≤–∞–µ–º</span>
    player.transactions.append(transaction)
    session.players.append(player)

    <span class="hljs-comment">// –í—Å—Ç–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç</span>
    context.insert(player)
    context.insert(transaction)

    <span class="hljs-comment">// SwiftData –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏</span>
}

<span class="hljs-comment">// 4. DATA LAYER</span>
<span class="hljs-comment">// SwiftData –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ ModelContainer</span>
<span class="hljs-comment">// View –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ @Bindable/@Query</span>
</div></code></pre>
<p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç</strong>:</p>
<ul>
<li>–í –ë–î —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π Player —Å id</li>
<li>–°–æ–∑–¥–∞—ë—Ç—Å—è PlayerTransaction —Ç–∏–ø–∞ buyIn</li>
<li>Player –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ session.players</li>
<li>UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
</ul>
<hr>
<h3 id="%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80-2-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%B5%D1%81%D1%81%D0%B8%D0%B8-cascade-delete-chain">–ü—Ä–∏–º–µ—Ä 2: –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (Cascade Delete Chain)</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// 1. VIEW LAYER</span>
<span class="hljs-comment">// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ SessionListView –¥–µ–ª–∞–µ—Ç swipe –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏</span>

<span class="hljs-comment">// 2. REPOSITORY LAYER</span>
repository.deleteSessions([session])

<span class="hljs-comment">// –í–Ω—É—Ç—Ä–∏ SwiftDataSessionsRepository:</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteSessions</span><span class="hljs-params">(<span class="hljs-number">_</span> sessions: [Session])</span></span> <span class="hljs-keyword">throws</span> {
    sessions.forEach(context.delete)
    <span class="hljs-keyword">try</span> context.save()
}

<span class="hljs-comment">// 3. SwiftData CASCADE DELETE (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):</span>
<span class="hljs-comment">// –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Session –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:</span>

<span class="hljs-type">Session</span> (—É–¥–∞–ª—è–µ—Ç—Å—è)
  ‚îÇ
  ‚îú‚îÄ‚ñ∫ <span class="hljs-type">Players</span> (cascade delete)
  ‚îÇ     ‚îî‚îÄ‚ñ∫ <span class="hljs-type">PlayerTransactions</span> (cascade delete)
  ‚îÇ
  ‚îú‚îÄ‚ñ∫ <span class="hljs-type">SessionBank</span> (cascade delete)
  ‚îÇ     ‚îî‚îÄ‚ñ∫ <span class="hljs-type">SessionBankTransactions</span> (cascade delete)
  ‚îÇ           ‚îî‚îÄ‚ñ∫ player: <span class="hljs-type">Player?</span> (nullify - —Å–≤—è–∑—å –æ–±–Ω—É–ª—è–µ—Ç—Å—è)
  ‚îÇ
  ‚îî‚îÄ‚ñ∫ <span class="hljs-type">Expenses</span> (cascade delete)
        ‚îî‚îÄ‚ñ∫ payer: <span class="hljs-type">Player?</span> (nullify - —Å–≤—è–∑—å –æ–±–Ω—É–ª—è–µ—Ç—Å—è)

<span class="hljs-comment">// –í–ê–ñ–ù–û:</span>
<span class="hljs-comment">// - –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Player, –µ–≥–æ —Å–≤—è–∑–∏ –≤ SessionBankTransaction –∏ Expense</span>
<span class="hljs-comment">//   —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è nil (deleteRule: .nullify)</span>
<span class="hljs-comment">// - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—à–∏ –∏–∑-–∑–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Å—ã–ª–æ–∫</span>
</div></code></pre>
<p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç</strong>:</p>
<ul>
<li>Session —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ë–î</li>
<li>–í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ Players –∏ –∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è</li>
<li>SessionBank –∏ –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è</li>
<li>Expenses —É–¥–∞–ª—è—é—Ç—Å—è</li>
<li>Nullify-—Å–≤—è–∑–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω—É–ª—è—é—Ç—Å—è</li>
</ul>
<hr>
<h3 id="%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80-3-%D1%80%D0%B0%D1%81%D1%87%D1%91%D1%82-settlement">–ü—Ä–∏–º–µ—Ä 3: –†–∞—Å—á—ë—Ç Settlement</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// 1. VIEW LAYER</span>
<span class="hljs-comment">// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ SessionBankView –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å Settlement"</span>
<span class="hljs-comment">// –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è sheet SettlementView</span>

<span class="hljs-comment">// 2. VIEWMODEL LAYER</span>
settlementViewModel.calculate()

<span class="hljs-comment">// –í–Ω—É—Ç—Ä–∏ SettlementViewModel:</span>
@<span class="hljs-type">Observable</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SettlementViewModel</span> </span>{
    <span class="hljs-keyword">var</span> result: <span class="hljs-type">SettlementResult?</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> settlementService: <span class="hljs-type">SettlementProtocol</span>

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span></span> {
        result = settlementService.calculate(<span class="hljs-keyword">for</span>: session)
    }
}

<span class="hljs-comment">// 3. SERVICE LAYER</span>
settlementService.calculate(<span class="hljs-keyword">for</span>: session)

<span class="hljs-comment">// –í–Ω—É—Ç—Ä–∏ SettlementService:</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">calculate</span><span class="hljs-params">(<span class="hljs-keyword">for</span> session: Session)</span></span> -&gt; <span class="hljs-type">SettlementResult</span> {
    <span class="hljs-keyword">var</span> balances: [<span class="hljs-type">Player</span>: <span class="hljs-type">Int</span>] = [:]

    <span class="hljs-comment">// –®–∞–≥ 1: –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–∞–Ω—Å –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞</span>
    <span class="hljs-keyword">for</span> player <span class="hljs-keyword">in</span> session.players {
        <span class="hljs-keyword">let</span> buyIn = player.transactions
            .<span class="hljs-built_in">filter</span> { $<span class="hljs-number">0</span>.type == .buyIn || $<span class="hljs-number">0</span>.type == .addOn }
            .<span class="hljs-built_in">reduce</span>(<span class="hljs-number">0</span>) { $<span class="hljs-number">0</span> + $<span class="hljs-number">1</span>.amount }

        <span class="hljs-keyword">let</span> cashOut = player.transactions
            .<span class="hljs-built_in">filter</span> { $<span class="hljs-number">0</span>.type == .cashOut }
            .<span class="hljs-built_in">reduce</span>(<span class="hljs-number">0</span>) { $<span class="hljs-number">0</span> + $<span class="hljs-number">1</span>.amount }

        balances[player] = cashOut - buyIn
    }

    <span class="hljs-comment">// –®–∞–≥ 2: –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –¥–æ–ª–∂–Ω–∏–∫–æ–≤ –∏ –∫—Ä–µ–¥–∏—Ç–æ—Ä–æ–≤</span>
    <span class="hljs-keyword">let</span> debtors = balances.<span class="hljs-built_in">filter</span> { $<span class="hljs-number">0</span>.value &lt; <span class="hljs-number">0</span> }
    <span class="hljs-keyword">let</span> creditors = balances.<span class="hljs-built_in">filter</span> { $<span class="hljs-number">0</span>.value &gt; <span class="hljs-number">0</span> }

    <span class="hljs-comment">// –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã (greedy algorithm)</span>
    <span class="hljs-keyword">var</span> transfers: [<span class="hljs-type">Transfer</span>] = []
    <span class="hljs-keyword">var</span> mutableDebtors = debtors
    <span class="hljs-keyword">var</span> mutableCreditors = creditors

    <span class="hljs-keyword">while</span> !mutableDebtors.isEmpty &amp;&amp; !mutableCreditors.isEmpty {
        <span class="hljs-keyword">let</span> debtor = mutableDebtors.<span class="hljs-built_in">max</span>(by: { $<span class="hljs-number">0</span>.value &gt; $<span class="hljs-number">1</span>.value })!
        <span class="hljs-keyword">let</span> creditor = mutableCreditors.<span class="hljs-built_in">max</span>(by: { $<span class="hljs-number">0</span>.value &lt; $<span class="hljs-number">1</span>.value })!

        <span class="hljs-keyword">let</span> amount = <span class="hljs-built_in">min</span>(<span class="hljs-built_in">abs</span>(debtor.value), creditor.value)

        transfers.append(<span class="hljs-type">Transfer</span>(
            from: debtor.key,
            to: creditor.key,
            amount: amount
        ))

        <span class="hljs-comment">// –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã</span>
        mutableDebtors[debtor.key]! += amount
        mutableCreditors[creditor.key]! -= amount

        <span class="hljs-keyword">if</span> mutableDebtors[debtor.key] == <span class="hljs-number">0</span> {
            mutableDebtors.removeValue(forKey: debtor.key)
        }
        <span class="hljs-keyword">if</span> mutableCreditors[creditor.key] == <span class="hljs-number">0</span> {
            mutableCreditors.removeValue(forKey: creditor.key)
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-type">SettlementResult</span>(
        balances: balances,
        transfers: transfers
    )
}

<span class="hljs-comment">// 4. VIEW LAYER</span>
<span class="hljs-comment">// SettlementView –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:</span>
<span class="hljs-comment">// - –ë–∞–ª–∞–Ω—Å—ã –∏–≥—Ä–æ–∫–æ–≤ (profit/loss)</span>
<span class="hljs-comment">// - –°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤: "–ò–≥—Ä–æ–∫ –ê ‚Üí –ò–≥—Ä–æ–∫ –ë: 500‚ÇΩ"</span>
</div></code></pre>
<p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç</strong>:</p>
<ul>
<li>–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç profit/loss –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞</li>
<li>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è settlement</li>
<li>–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫—Ç–æ –∫–æ–º—É –¥–æ–ª–∂–µ–Ω –∏ —Å–∫–æ–ª—å–∫–æ</li>
</ul>
<hr>
<h2 id="%F0%9F%9B%A0%EF%B8%8F-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-services">üõ†Ô∏è –û–ø–∏—Å–∞–Ω–∏–µ Services</h2>
<h3 id="sessionservice"><strong>SessionService</strong></h3>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π</p>
<p><strong>–ú–µ—Ç–æ–¥—ã</strong>:</p>
<ul>
<li><code>addPlayer(to:name:buyIn:context:)</code> - –¥–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞ —Å buy-in</li>
<li><code>addOn(for:amount:context:)</code> - add-on –¥–ª—è –∏–≥—Ä–æ–∫–∞</li>
<li><code>cashOut(for:amount:context:)</code> - cash-out –∏–≥—Ä–æ–∫–∞</li>
<li><code>rebuyPlayer(for:amount:context:)</code> - rebuy –∏–≥—Ä–æ–∫–∞</li>
<li><code>removePlayer(_:from:context:)</code> - —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –∏–∑ —Å–µ—Å—Å–∏–∏</li>
<li><code>ensureBank(for:context:)</code> - —Å–æ–∑–¥–∞—Ç—å –±–∞–Ω–∫ –µ—Å–ª–∏ –Ω–µ—Ç</li>
<li><code>recordBankTransaction(to:type:amount:note:player:context:)</code> - –∑–∞–ø–∏—Å–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –±–∞–Ω–∫–∞</li>
<li><code>addExpense(to:amount:note:payer:context:)</code> - –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</li>
<li><code>updateBlinds(for:smallBlind:bigBlind:ante:context:)</code> - –æ–±–Ω–æ–≤–∏—Ç—å –±–ª–∞–π–Ω–¥—ã</li>
</ul>
<p><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong>: <code>SessionDetailViewModel</code> –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —ç—Ç–æ–º—É —Å–µ—Ä–≤–∏—Å—É</p>
<hr>
<h3 id="settlementservice"><strong>SettlementService</strong></h3>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>: –†–∞—Å—á—ë—Ç settlement –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏</p>
<p><strong>–ú–µ—Ç–æ–¥—ã</strong>:</p>
<ul>
<li><code>calculate(for:) -&gt; SettlementResult</code> - —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–∞–Ω—Å—ã –∏ –ø–µ—Ä–µ–≤–æ–¥—ã</li>
</ul>
<p><strong>–ê–ª–≥–æ—Ä–∏—Ç–º</strong>: Greedy algorithm –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤</p>
<p><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong>: <code>SettlementViewModel</code> –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ SettlementView</p>
<hr>
<h3 id="sessiontimerservice"><strong>SessionTimerService</strong></h3>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>: –õ–æ–≥–∏–∫–∞ —Ç–∞–π–º–µ—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–∞</p>
<p><strong>–ú–µ—Ç–æ–¥—ã</strong>:</p>
<ul>
<li><code>calculateCurrentLevel(items:startTime:currentTime:) -&gt; TimerState</code> - –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å</li>
<li><code>calculateLevelStartTime(items:startTime:targetIndex:) -&gt; Date?</code> - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —É—Ä–æ–≤–Ω—è</li>
<li><code>durationInSeconds(for:) -&gt; Int</code> - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö</li>
</ul>
<p><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong>: <code>TimerViewModel</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–æ–º</p>
<hr>
<h3 id="templateservice"><strong>TemplateService</strong></h3>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ —Ç—É—Ä–Ω–∏—Ä–æ–≤</p>
<p><strong>–ú–µ—Ç–æ–¥—ã</strong>:</p>
<ul>
<li><code>getBuiltInTemplates() -&gt; [TournamentTemplate]</code> - –ø–æ–ª—É—á–∏—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã</li>
<li><code>loadUserTemplates() -&gt; [TournamentTemplate]</code> - –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã</li>
<li><code>deleteTemplate(_:)</code> - —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω</li>
</ul>
<p><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong>: <code>TemplateViewModel</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏</p>
<hr>
<h2 id="%F0%9F%8E%AF-%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-viewmodels">üéØ –û–ø–∏—Å–∞–Ω–∏–µ ViewModels</h2>
<h3 id="sessiondetailviewmodel"><strong>SessionDetailViewModel</strong></h3>
<pre class="hljs"><code><div>@<span class="hljs-type">Observable</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SessionDetailViewModel</span> </span>{
    <span class="hljs-keyword">var</span> session: <span class="hljs-type">Session</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> sessionService: <span class="hljs-type">SessionServiceProtocol</span>

    <span class="hljs-comment">// –ú–µ—Ç–æ–¥—ã –¥–µ–ª–µ–≥–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É –≤ SessionService</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addPlayer</span><span class="hljs-params">(name: String, buyIn: Int)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cashOutPlayer</span><span class="hljs-params">(<span class="hljs-number">_</span> player: Player, amount: Int)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addExpense</span><span class="hljs-params">(amount: Int, note: String, payer: Player?)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateBlinds</span><span class="hljs-params">(small: Int, big: Int, ante: Int)</span></span>
    <span class="hljs-comment">// ...</span>
}
</div></code></pre>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>:</p>
<ul>
<li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º SessionDetailView</li>
<li>–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞</li>
<li>–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ SessionService</li>
</ul>
<hr>
<h3 id="timerviewmodel"><strong>TimerViewModel</strong></h3>
<pre class="hljs"><code><div>@<span class="hljs-type">Observable</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimerViewModel</span> </span>{
    <span class="hljs-keyword">var</span> items: [<span class="hljs-type">LevelItem</span>]
    <span class="hljs-keyword">var</span> currentState: <span class="hljs-type">TimerState</span>
    <span class="hljs-keyword">var</span> showConfigForm: <span class="hljs-type">Bool</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> timerService: <span class="hljs-type">SessionTimerProtocol</span>

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pause</span><span class="hljs-params">()</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">resume</span><span class="hljs-params">()</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">skipToNextLevel</span><span class="hljs-params">()</span></span>
    <span class="hljs-comment">// ...</span>
}
</div></code></pre>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>:</p>
<ul>
<li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ç–∞–π–º–µ—Ä–∞ (running/paused/finished)</li>
<li>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏</li>
<li>–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ –∞–∫—Ç–∏–≤–Ω—ã–º —Ç–∞–π–º–µ—Ä–æ–º</li>
</ul>
<hr>
<h3 id="templateviewmodel"><strong>TemplateViewModel</strong></h3>
<pre class="hljs"><code><div>@<span class="hljs-type">Observable</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TemplateViewModel</span> </span>{
    <span class="hljs-keyword">var</span> builtInTemplates: [<span class="hljs-type">TournamentTemplate</span>]
    <span class="hljs-keyword">var</span> userTemplates: [<span class="hljs-type">TournamentTemplate</span>]
    <span class="hljs-keyword">var</span> editedTemplate: <span class="hljs-type">TournamentTemplate?</span>
    <span class="hljs-keyword">var</span> validationWarnings: [<span class="hljs-type">String</span>]
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> templateService: <span class="hljs-type">TemplateServiceProtocol</span>

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadTemplates</span><span class="hljs-params">()</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createNewTemplate</span><span class="hljs-params">()</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveTemplate</span><span class="hljs-params">()</span></span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteTemplate</span><span class="hljs-params">()</span></span>
    <span class="hljs-comment">// ...</span>
}
</div></code></pre>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>:</p>
<ul>
<li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —à–∞–±–ª–æ–Ω–æ–≤</li>
<li>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤</li>
<li>–†–∞–±–æ—Ç–∞ —Å —É—Ä–æ–≤–Ω—è–º–∏ –±–ª–∞–π–Ω–¥–æ–≤</li>
</ul>
<hr>
<h3 id="settlementviewmodel"><strong>SettlementViewModel</strong></h3>
<pre class="hljs"><code><div>@<span class="hljs-type">Observable</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SettlementViewModel</span> </span>{
    <span class="hljs-keyword">var</span> result: <span class="hljs-type">SettlementResult?</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> settlementService: <span class="hljs-type">SettlementProtocol</span>

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span></span>
}
</div></code></pre>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>:</p>
<ul>
<li>–ó–∞–ø—É—Å–∫ —Ä–∞—Å—á—ë—Ç–∞ settlement</li>
<li>–•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI</li>
</ul>
<hr>
<h2 id="%F0%9F%93%A6-repository">üì¶ Repository</h2>
<h3 id="swiftdatasessionsrepository"><strong>SwiftDataSessionsRepository</strong></h3>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">SessionsRepository</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSessions</span><span class="hljs-params">()</span></span> -&gt; [<span class="hljs-type">Session</span>]
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createSession</span><span class="hljs-params">(<span class="hljs-number">_</span>: Session)</span></span> <span class="hljs-keyword">throws</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteSessions</span><span class="hljs-params">(<span class="hljs-number">_</span>: [Session])</span></span> <span class="hljs-keyword">throws</span>
}

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwiftDataSessionsRepository</span>: <span class="hljs-title">SessionsRepository</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> context: <span class="hljs-type">ModelContext</span>

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSessions</span><span class="hljs-params">()</span></span> -&gt; [<span class="hljs-type">Session</span>] {
        <span class="hljs-keyword">let</span> descriptor = <span class="hljs-type">FetchDescriptor</span>&lt;<span class="hljs-type">Session</span>&gt;(
            sortBy: [<span class="hljs-type">SortDescriptor</span>(\.startTime, order: .<span class="hljs-built_in">reverse</span>)]
        )
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">try</span>? context.fetch(descriptor)) ?? []
    }

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createSession</span><span class="hljs-params">(<span class="hljs-number">_</span> session: Session)</span></span> <span class="hljs-keyword">throws</span> {
        context.insert(session)
        <span class="hljs-keyword">try</span> context.save()
    }

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteSessions</span><span class="hljs-params">(<span class="hljs-number">_</span> sessions: [Session])</span></span> <span class="hljs-keyword">throws</span> {
        sessions.forEach(context.delete)
        <span class="hljs-keyword">try</span> context.save()
    }
}
</div></code></pre>
<p><strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</strong>:</p>
<ul>
<li>–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ SwiftData</li>
<li>CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è Session</li>
<li>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è</li>
</ul>
<p><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong>: <code>SessionListView</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–µ—Å—Å–∏–π</p>
<hr>
<h2 id="%F0%9F%8E%A8-%D0%BF%D0%BE%D0%BB%D0%BD%D0%B0%D1%8F-%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D0%BE%D0%B2">üé® –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h2>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph App["üè† Home Poker App"]
        Entry[HomePokerApp]
        Entry --> Container[(ModelContainer)]
        Entry --> MainView
    end

    subgraph Sessions["üìã Session Feature"]
        List[SessionListView]
        Detail[SessionDetailView]
        Bank[SessionBankView]

        List --> DetailVM[SessionDetailViewModel]
        Detail --> DetailVM
        Bank --> DetailVM

        DetailVM --> SessionSvc[SessionService]
        SessionSvc --> Container

        List --> Repo[SessionsRepository]
        Repo --> Container
    end

    subgraph Timer["‚è±Ô∏è Timer Feature"]
        TimerMgr[TimerManagerView]
        TimerView[TimerView]
        TemplatePicker[TemplatePickerView]

        TimerMgr --> TimerVM[TimerViewModel]
        TimerMgr --> TemplateVM[TemplateViewModel]

        TimerVM --> TimerSvc[SessionTimerService]
        TemplateVM --> TemplateSvc[TemplateService]
    end

    subgraph Settlement["üí∞ Settlement Feature"]
        SettleView[SettlementView]
        SettleView --> SettleVM[SettlementViewModel]
        SettleVM --> SettleSvc[SettlementService]
        SettleSvc --> Container
    end

    MainView --> List
    MainView --> TimerMgr
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9D-%D0%B7%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8-%D0%BF%D0%BE-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B5">üìù –ó–∞–º–µ—Ç–∫–∏ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ</h2>
<h3 id="%D0%BF%D1%80%D0%B5%D0%B8%D0%BC%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%B0-%D1%82%D0%B5%D0%BA%D1%83%D1%89%D0%B5%D0%B9-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D1%8B">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:</h3>
<p>‚úÖ <strong>–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</strong>: View ‚Üí ViewModel ‚Üí Service ‚Üí Data
‚úÖ <strong>–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å</strong>: Services –ø–æ–∫—Ä—ã—Ç—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏, –ª–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å
‚úÖ <strong>–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong>: FormSheetView, —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
‚úÖ <strong>SwiftData integration</strong>: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è UI —á–µ—Ä–µ–∑ @Query/@Bindable
‚úÖ <strong>Cascade deletes</strong>: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤—è–∑–µ–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏</p>
<h3 id="%D0%BF%D0%BE%D1%82%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%83%D0%BB%D1%83%D1%87%D1%88%D0%B5%D0%BD%D0%B8%D1%8F">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:</h3>
<p>‚ö†Ô∏è <strong>Schema versioning</strong>: –î–æ–±–∞–≤–∏—Ç—å VersionedSchema –∏ MigrationPlan –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
‚ö†Ô∏è <strong>Error handling</strong>: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚ö†Ô∏è <strong>Logging</strong>: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
‚ö†Ô∏è <strong>Repository pattern</strong>: –†–∞—Å—à–∏—Ä–∏—Ç—å –Ω–∞ –≤—Å–µ –º–æ–¥–µ–ª–∏, –Ω–µ —Ç–æ–ª—å–∫–æ Session</p>
<hr>
<p><strong>–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω</strong>: 28 –æ–∫—Ç—è–±—Ä—è 2025
<strong>–í–µ—Ä—Å–∏—è</strong>: 2.0</p>

</body>
</html>
