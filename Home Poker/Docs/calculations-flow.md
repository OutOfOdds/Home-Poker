# Home Poker - –†–∞—Å—á—ë—Ç—ã –∏ –≠–∫–æ–Ω–æ–º–∏–∫–∏

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–î–≤–µ —ç–∫–æ–Ω–æ–º–∏–∫–∏: –§–∏—à–∫–∏ –∏ –î–µ–Ω—å–≥–∏](#–¥–≤–µ-—ç–∫–æ–Ω–æ–º–∏–∫–∏-—Ñ–∏—à–∫–∏-–∏-–¥–µ–Ω—å–≥–∏)
2. [–†–æ–ª—å chipToCashRatio](#—Ä–æ–ª—å-chiptocashratio)
3. [Chip Economy: –ò–≥—Ä–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏](#chip-economy-–∏–≥—Ä–æ–≤—ã–µ-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
4. [Cash Economy: –†–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏](#cash-economy-—Ä–µ–∞–ª—å–Ω—ã–µ-–¥–µ–Ω—å–≥–∏)
5. [SessionBank: –†–∞—Å—á—ë—Ç—ã –±–∞–Ω–∫–∞](#sessionbank-—Ä–∞—Å—á—ë—Ç—ã-–±–∞–Ω–∫–∞)
6. [Settlement: –†–∞—Å—á—ë—Ç—ã –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏](#settlement-—Ä–∞—Å—á—ë—Ç—ã-–º–µ–∂–¥—É-–∏–≥—Ä–æ–∫–∞–º–∏)
7. [–ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–æ–≤](#–ø—Ä–∏–º–µ—Ä—ã-—Ä–∞—Å—á—ë—Ç–æ–≤)

---

## –î–≤–µ —ç–∫–æ–Ω–æ–º–∏–∫–∏: –§–∏—à–∫–∏ –∏ –î–µ–Ω—å–≥–∏

–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç **–¥–≤–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏–∫–∏**:

### üé∞ Chip Economy (–§–∏—à–∫–∏ - –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞)
- –í—Å–µ –∏–≥—Ä–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: buy-in, rebuy, add-on, cash-out
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–≤ (profit/loss) —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∏—à–∫–∞—Ö
- **–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è**: —Ñ–∏—à–∫–∏ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)
- **–ú–æ–¥–µ–ª–∏**: `PlayerTransaction`, `Player` (buyIn, cashOut, profit)

### üíµ Cash Economy (–ù–∞–ª–∏—á–Ω—ã–µ - —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–µ–Ω—å–≥–∞–º–∏: –≤–∑–Ω–æ—Å—ã –≤ –±–∞–Ω–∫, –≤—ã–¥–∞—á–∏ –∏–∑ –±–∞–Ω–∫–∞
- –†–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥—É, –Ω–∞–ø–∏—Ç–∫–∏ –∏ —Ç.–¥.
- –ü–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
- **–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è**: —Ä—É–±–ª–∏ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)
- **–ú–æ–¥–µ–ª–∏**: `SessionBankTransaction`, `Expense`, `Settlement.Transfer`

### ‚öñÔ∏è –°–≤—è–∑—å –º–µ–∂–¥—É —ç–∫–æ–Ω–æ–º–∏–∫–∞–º–∏
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä **`chipToCashRatio`** –≤ –º–æ–¥–µ–ª–∏ `Session`:
```
cash_amount = chip_amount √ó chipToCashRatio
```

---

## –†–æ–ª—å chipToCashRatio

### –ß—Ç–æ —ç—Ç–æ?
`chipToCashRatio` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ñ–∏—à–µ–∫ –≤ —Ä—É–±–ª–∏.

### –ü—Ä–∏–º–µ—Ä—ã:
- `chipToCashRatio = 1` ‚Üí 1 —Ñ–∏—à–∫–∞ = 1 —Ä—É–±–ª—å
- `chipToCashRatio = 10` ‚Üí 1 —Ñ–∏—à–∫–∞ = 10 —Ä—É–±–ª–µ–π
- `chipToCashRatio = 100` ‚Üí 1 —Ñ–∏—à–∫–∞ = 100 —Ä—É–±–ª–µ–π

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
1. **SessionBank —Ä–∞—Å—á—ë—Ç—ã** - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–∂–∏–¥–∞–µ–º—ã—Ö –¥–æ–ª–≥–æ–≤ –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ —Ñ–∏—à–µ–∫ –≤ —Ä—É–±–ª–∏
2. **Settlement —Ä–∞—Å—á—ë—Ç—ã** - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ —Ñ–∏—à–µ–∫ –≤ —Å—É–º–º—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤
3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤ UI** - –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è cash-—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–∞ —Ñ–∏—à–µ–∫

---

## Chip Economy: –ò–≥—Ä–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### PlayerTransaction
–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **—Ñ–∏—à–∫–∞—Ö**:

```swift
enum TransactionType {
    case buyIn   // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–∫—É–ø–∫–∞ —Ñ–∏—à–µ–∫
    case addOn   // –î–æ–∫—É–ø–∫–∞ —Ñ–∏—à–µ–∫
    case cashOut // –í—ã–≤–æ–¥ —Ñ–∏—à–µ–∫
}
```

### Player - Computed Properties (–≤—Å—ë –≤ —Ñ–∏—à–∫–∞—Ö)

```swift
// –°—É–º–º–∞ –≤—Å–µ—Ö –∑–∞–∫—É–ø–æ–∫ (buyIn + addOn)
var buyIn: Int {
    transactions
        .filter { $0.type == .buyIn || $0.type == .addOn }
        .reduce(0) { $0 + $1.amount }
}

// –°—É–º–º–∞ –≤—Å–µ—Ö –≤—ã–≤–æ–¥–æ–≤
var cashOut: Int {
    transactions
        .filter { $0.type == .cashOut }
        .reduce(0) { $0 + $1.amount }
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä–æ–∫–∞ –≤ –§–ò–®–ö–ê–•
var profit: Int {
    cashOut - buyIn
}

// –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
var balance: Int {
    guard inGame else { return 0 }
    return buyIn - cashOut
}
```

### –ü—Ä–∏–º–µ—Ä:
–ò–≥—Ä–æ–∫ –í–∞—Å—è:
- BuyIn: 100 —Ñ–∏—à–µ–∫ (PlayerTransaction, type: .buyIn)
- AddOn: 50 —Ñ–∏—à–µ–∫ (PlayerTransaction, type: .addOn)
- CashOut: 80 —Ñ–∏—à–µ–∫ (PlayerTransaction, type: .cashOut)

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- `buyIn` = 100 + 50 = **150 —Ñ–∏—à–µ–∫**
- `cashOut` = **80 —Ñ–∏—à–µ–∫**
- `profit` = 80 - 150 = **-70 —Ñ–∏—à–µ–∫** (–ø—Ä–æ–∏–≥—Ä—ã—à)

---

## Cash Economy: –†–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏

### SessionBankTransaction
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞–Ω–∫–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **—Ä—É–±–ª—è—Ö**:

```swift
enum SessionBankTransactionType {
    case deposit    // –í–Ω–µ—Å–µ–Ω–∏–µ –¥–µ–Ω–µ–≥ –≤ –±–∞–Ω–∫
    case withdrawal // –í—ã–¥–∞—á–∞ –¥–µ–Ω–µ–≥ –∏–∑ –±–∞–Ω–∫–∞
}
```

### Expense
–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥—É, –Ω–∞–ø–∏—Ç–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **—Ä—É–±–ª—è—Ö**:

```swift
struct Expense {
    var amount: Int    // –í —Ä—É–±–ª—è—Ö
    var note: String
    var payer: Player?
}
```

### –ü—Ä–∏–º–µ—Ä:
–ò–≥—Ä–æ–∫ –í–∞—Å—è:
- Deposit: 1000‚ÇΩ (SessionBankTransaction, type: .deposit)
- Deposit: 500‚ÇΩ (SessionBankTransaction, type: .deposit)

–ò—Ç–æ–≥–æ –≤–Ω–µ—Å–µ–Ω–æ: **1500‚ÇΩ**

---

## SessionBank: –ï–¥–∏–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä

### –ó–∞–¥–∞—á–∞ SessionBank
SessionBank - —ç—Ç–æ **–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤. –ë–∞–Ω–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
- –ö—Ç–æ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É (–ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –∏–≥—Ä–æ–∫–∏)
- –ö–æ–º—É –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫ (–≤—ã–∏–≥—Ä–∞–≤—à–∏–µ –∏–≥—Ä–æ–∫–∏ + –ø–µ—Ä–µ–ø–ª–∞—Ç–∏–≤—à–∏–µ)
- –†–µ–∞–ª—å–Ω—ã–µ cash-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (deposits/withdrawals)

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

#### 1. `amountOwedToBank(for player:)` - –°–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É (—Ä—É–±–ª–∏)

```swift
func amountOwedToBank(for player: Player) -> Int {
    guard !player.inGame else { return 0 }

    // –ï—Å–ª–∏ –±–∞–Ω–∫ —á—Ç–æ-—Ç–æ –¥–æ–ª–∂–µ–Ω –∏–≥—Ä–æ–∫—É, —Ç–æ –∏–≥—Ä–æ–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É
    let bankOwes = amountOwedByBank(for: player)
    if bankOwes > 0 { return 0 }

    let profit = player.cashOut - player.buyIn
    let profitInCash = profit * session.chipsToCashRatio
    let (deposited, withdrawn) = contributions(for: player)
    let netContribution = deposited - withdrawn

    // –ò–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω = abs(—É–±—ã—Ç–æ–∫) - —É–∂–µ –≤–Ω–µ—Å—ë–Ω–Ω–æ–µ
    let playerOwes = -profitInCash - netContribution
    return max(playerOwes, 0)
}
```

**–õ–æ–≥–∏–∫–∞:**
1. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å profit: `cashOut - buyIn` (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)
2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä—É–±–ª–∏: `profitInCash = profit √ó chipToCashRatio`
3. –í—ã—á–µ—Å—Ç—å —É–∂–µ –≤–Ω–µ—Å—ë–Ω–Ω–æ–µ: `debt = -profitInCash - netContribution`
4. –ï—Å–ª–∏ debt > 0 ‚Üí –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª 50‚ÇΩ, –≤–Ω—ë—Å 30‚ÇΩ ‚Üí –¥–æ–ª–∂–µ–Ω 20‚ÇΩ
- –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª 50‚ÇΩ, –≤–Ω—ë—Å 60‚ÇΩ ‚Üí –¥–æ–ª–∂–µ–Ω 0‚ÇΩ
- –ò–≥—Ä–æ–∫ –≤—ã–∏–≥—Ä–∞–ª 100‚ÇΩ ‚Üí –¥–æ–ª–∂–µ–Ω 0‚ÇΩ

#### 2. `amountOwedByBank(for player:)` - –°–∫–æ–ª—å–∫–æ –±–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –∏–≥—Ä–æ–∫—É (—Ä—É–±–ª–∏)

```swift
func amountOwedByBank(for player: Player) -> Int {
    guard !player.inGame else { return 0 }

    let profit = player.cashOut - player.buyIn
    let profitInCash = profit * session.chipsToCashRatio
    let (deposited, withdrawn) = contributions(for: player)
    let netContribution = deposited - withdrawn

    // –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω = –ø—Ä–æ—Ñ–∏—Ç + –≤–Ω–µ—Å—ë–Ω–Ω–æ–µ –∏–≥—Ä–æ–∫–æ–º - –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–≥—Ä–æ–∫–æ–º
    let bankOwes = profitInCash + netContribution
    return max(bankOwes, 0)
}
```

**–õ–æ–≥–∏–∫–∞:**
1. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å profit –≤ —Ä—É–±–ª—è—Ö: `profitInCash = (cashOut - buyIn) √ó chipToCashRatio`
2. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —á–∏—Å—Ç—ã–π –≤–∫–ª–∞–¥ –∏–≥—Ä–æ–∫–∞: `netContribution = deposited - withdrawn`
   - –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ **–≤–Ω–æ—Å–∏–ª** –¥–µ–Ω—å–≥–∏ ‚Üí `netContribution > 0` ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ–ª–≥ –±–∞–Ω–∫–∞
   - –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ **–ø–æ–ª—É—á–∞–ª** –¥–µ–Ω—å–≥–∏ ‚Üí `netContribution < 0` ‚Üí —É–º–µ–Ω—å—à–∞–µ—Ç –¥–æ–ª–≥ –±–∞–Ω–∫–∞
3. –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω = `profitInCash + netContribution`

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ò–≥—Ä–æ–∫ –≤—ã–∏–≥—Ä–∞–ª 100‚ÇΩ, –Ω–∏—á–µ–≥–æ –Ω–µ –≤–Ω–æ—Å–∏–ª: `100 + 0 = 100‚ÇΩ` ‚úì
- –ò–≥—Ä–æ–∫ –≤—ã–∏–≥—Ä–∞–ª 100‚ÇΩ, –≤–Ω—ë—Å 5‚ÇΩ: `100 + 5 = 105‚ÇΩ` ‚úì (–≤—ã–∏–≥—Ä—ã—à + –¥–µ–ø–æ–∑–∏—Ç)
- –ò–≥—Ä–æ–∫ –≤—ã–∏–≥—Ä–∞–ª 100‚ÇΩ, –ø–æ–ª—É—á–∏–ª 30‚ÇΩ: `100 + (0-30) = 70‚ÇΩ` ‚úì (–≤—ã–∏–≥—Ä—ã—à - –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ)
- –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª 50‚ÇΩ, –≤–Ω—ë—Å 100‚ÇΩ: `-50 + 100 = 50‚ÇΩ` ‚úì (–ø–µ—Ä–µ–ø–ª–∞—Ç–∞)
- –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª 50‚ÇΩ, –≤–Ω—ë—Å 30‚ÇΩ: `-50 + 30 = -20‚ÇΩ` ‚Üí `max(-20, 0) = 0‚ÇΩ` ‚úì

#### 3. Computed Properties

```swift
// –û–±—â–∞—è —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –±–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
var totalOwedByBank: Int {
    session.players.reduce(0) { $0 + amountOwedByBank(for: $1) }
}

// –ò–≥—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±–∞–Ω–∫—É
var playersOwingBank: [Player] {
    session.players.filter { amountOwedToBank(for: $0) > 0 }
}

// –ò–≥—Ä–æ–∫–∏, –∫–æ–º—É –±–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω (–≤—ã–∏–≥—Ä–∞–≤—à–∏–µ + –ø–µ—Ä–µ–ø–ª–∞—Ç–∏–≤—à–∏–µ)
var playersOwedByBank: [Player] {
    session.players.filter { amountOwedByBank(for: $0) > 0 }
}
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è SessionBank

### SessionBank –∫–∞–∫ –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

SessionBank —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ **–µ–¥–∏–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä**, –∫–æ—Ç–æ—Ä—ã–π:

1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ cash-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
   - Deposits (–≤–Ω–µ—Å–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤)
   - Withdrawals (–≤—ã–¥–∞—á–∏ –∏–≥—Ä–æ–∫–∞–º)
   - –§–∏–∑–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å –±–∞–Ω–∫–∞ (`netBalance = deposited - withdrawn`)

2. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ–ª–≥–∏**
   - –ö—Ç–æ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É (`playersOwingBank`)
   - –ö–æ–º—É –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫ (`playersOwedByBank`)
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ –∏–≥—Ä–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ç–∞–∫ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

3. **–†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Settlement**
   - Settlement —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç **–∏–¥–µ–∞–ª—å–Ω—ã–µ** –ø–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏
   - SessionBank –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—ã–µ** –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
   - –û–Ω–∏ –¥–æ–ø–æ–ª–Ω—è—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –Ω–æ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

**–ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –¥–æ–ª–≥–æ–≤:**
- –í—ã–∏–≥—Ä–∞–≤—à–∏–µ –∏–≥—Ä–æ–∫–∏ (profit > 0) ‚Üí –±–∞–Ω–∫ –∏–º –¥–æ–ª–∂–µ–Ω
- –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –∏–≥—Ä–æ–∫–∏ (profit < 0) ‚Üí –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±–∞–Ω–∫—É
- –ü–µ—Ä–µ–ø–ª–∞—Ç–∏–≤—à–∏–µ ‚Üí –±–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ä–∞–∑–Ω–∏—Ü—É

**–£—á—ë—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
- –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤–Ω—ë—Å –¥–µ–Ω—å–≥–∏ ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `netContribution`
- –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∏–ª –¥–µ–Ω—å–≥–∏ ‚Üí —É–º–µ–Ω—å—à–∞–µ—Ç `netContribution`
- –ò—Ç–æ–≥–æ–≤—ã–π –¥–æ–ª–≥ = `profitInCash + netContribution`

---

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**Buy-In / Add-On:**
```swift
// –°–æ–∑–¥–∞—ë—Ç—Å—è PlayerTransaction —Å —Ç–∏–ø–æ–º .buyIn –∏–ª–∏ .addOn
player.inGame = true
```

**Cash-Out:**
```swift
// –°–æ–∑–¥–∞—ë—Ç—Å—è PlayerTransaction —Å —Ç–∏–ø–æ–º .cashOut
player.inGame = false
```

### –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–õ–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞** (`SessionService.removeTransaction`):

```swift
func removeTransaction(_ transaction: PlayerTransaction, from session: Session) {
    // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
    player.transactions.removeAll { $0.id == transaction.id }

    // –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª cash-out, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∏–≥—Ä–æ–∫–∞
    if transaction.type == .cashOut {
        let hasCashOut = player.transactions.contains { $0.type == .cashOut }
        player.inGame = !hasCashOut  // –ò–≥—Ä–æ–∫ –∞–∫—Ç–∏–≤–µ–Ω, –µ—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö cash-out
    }

    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º expectedTotal
    refreshBankExpectation(for: session)
}
```

**–ü—Ä–∏–º–µ—Ä—ã:**

**–°—Ü–µ–Ω–∞—Ä–∏–π A: –£–¥–∞–ª–µ–Ω–∏–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ cash-out**
```
–î–æ:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: [buyIn(100), cashOut(150)]
- player.inGame = false

–£–¥–∞–ª—è–µ–º cashOut(150):
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: [buyIn(100)]
- hasCashOut = false
- player.inGame = true ‚úì (–∏–≥—Ä–æ–∫ –≤–µ—Ä–Ω—É–ª—Å—è –≤ –∏–≥—Ä—É)
```

**–°—Ü–µ–Ω–∞—Ä–∏–π B: –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö cash-out**
```
–î–æ:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: [buyIn(100), cashOut(150), rebuy(50), cashOut(80)]
- player.inGame = false

–£–¥–∞–ª—è–µ–º cashOut(80):
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: [buyIn(100), cashOut(150), rebuy(50)]
- hasCashOut = true (cashOut(150) –æ—Å—Ç–∞–ª—Å—è)
- player.inGame = false ‚úì (–∏–≥—Ä–æ–∫ –≤—Å—ë –µ—â—ë –∑–∞–≤–µ—Ä—à–∏–ª –ø–æ—Å–ª–µ cashOut(150))
```

**–í–∞–∂–Ω–æ:** –°—Ç–∞—Ç—É—Å `inGame` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **–Ω–∞–ª–∏—á–∏–µ–º —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ** cash-out, –∞ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

---

## –†–∞—Å—á—ë—Ç expectedBankTotal

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`expectedBankTotal` ‚Äî —ç—Ç–æ —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –±–∞–Ω–∫ **–æ–∂–∏–¥–∞–µ—Ç —Å–æ–±—Ä–∞—Ç—å** —Å –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤.

### –§–æ—Ä–º—É–ª–∞

```swift
private func expectedBankTotal(for session: Session) -> Int {
    session.players
        .filter { !$0.inGame }              // –¢–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–∏–≤—à–∏–µ
        .reduce(0) { partial, player in
            let chipBalance = max(player.buyIn - player.cashOut, 0)  // –¢–æ–ª—å–∫–æ –¥–æ–ª–∂–Ω–∏–∫–∏
            let cashBalance = chipBalance * session.chipsToCashRatio
            return partial + cashBalance
        }
}
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–∏–≤—à–∏–µ –∏–≥—Ä–æ–∫–∏** (`!player.inGame`)
   - –ò–≥—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –≤ –∏–≥—Ä–µ, –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

2. **–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ–ª–∂–Ω–∏–∫–∏** (`max(..., 0)`)
   - –í—ã–∏–≥—Ä–∞–≤—à–∏–µ –∏–≥—Ä–æ–∫–∏ (cashOut > buyIn) ‚Üí chipBalance = 0
   - –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –∏–≥—Ä–æ–∫–∏ (buyIn > cashOut) ‚Üí chipBalance > 0

3. **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ cash** —á–µ—Ä–µ–∑ `chipToCashRatio`

### –ü—Ä–∏–º–µ—Ä

**–°–µ—Å—Å–∏—è —Å chipToCashRatio = 1:**

| –ò–≥—Ä–æ–∫ | buyIn | cashOut | inGame | chipBalance | –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è? | –°—É–º–º–∞ |
|-------|-------|---------|--------|-------------|--------------|-------|
| –í–∞—Å—è  | 100   | 200     | false  | 0           | ‚ùå (–≤—ã–∏–≥—Ä–∞–ª) | 0‚ÇΩ    |
| –ü–µ—Ç—è  | 100   | 50      | false  | 50          | ‚úì            | 50‚ÇΩ   |
| –ö–æ–ª—è  | 100   | -       | true   | -           | ‚ùå (–≤ –∏–≥—Ä–µ)  | 0‚ÇΩ    |
| –î–∏–º–∞  | 100   | 30      | false  | 70          | ‚úì            | 70‚ÇΩ   |

**expectedBankTotal = 50 + 70 = 120‚ÇΩ**

---

## –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞—Å—á—ë—Ç–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –í—ã–∏–≥—Ä–∞–≤—à–∏–π –≤–Ω–æ—Å–∏—Ç –¥–µ–Ω—å–≥–∏ –≤ –±–∞–Ω–∫

**–ò–≥—Ä–æ–∫: –ê–ª–∏—Å–∞**
- BuyIn: 100 —Ñ–∏—à–µ–∫
- CashOut: 200 —Ñ–∏—à–µ–∫
- Profit: +100 —Ñ–∏—à–µ–∫
- chipToCashRatio: 1

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ê–ª–∏—Å–∞ –≤–Ω–æ—Å–∏—Ç –≤ –±–∞–Ω–∫: 50‚ÇΩ

**–†–∞—Å—á—ë—Ç—ã:**
```swift
profitInCash = 100 √ó 1 = 100‚ÇΩ
netContribution = 50 - 0 = 50‚ÇΩ
bankOwes = 100 + 50 = 150‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –ê–ª–∏—Å–µ **150‚ÇΩ** (–µ—ë –≤—ã–∏–≥—Ä—ã—à 100‚ÇΩ + –µ—ë –¥–µ–ø–æ–∑–∏—Ç 50‚ÇΩ)

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –ê–ª–∏—Å–∞ –≤—ã–∏–≥—Ä–∞–ª–∞ –∏ –ø—Ä–∏ —ç—Ç–æ–º –µ—â—ë –≤–Ω–µ—Å–ª–∞ –¥–µ–Ω—å–≥–∏. –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –µ–π –∏ –≤—ã–∏–≥—Ä—ã—à, –∏ –¥–µ–ø–æ–∑–∏—Ç.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π –ø–µ—Ä–µ–ø–ª–∞—á–∏–≤–∞–µ—Ç

**–ò–≥—Ä–æ–∫: –ë–æ–±**
- BuyIn: 100 —Ñ–∏—à–µ–∫
- CashOut: 50 —Ñ–∏—à–µ–∫
- Profit: -50 —Ñ–∏—à–µ–∫
- chipToCashRatio: 1

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ë–æ–± –≤–Ω–æ—Å–∏—Ç –≤ –±–∞–Ω–∫: 100‚ÇΩ

**–†–∞—Å—á—ë—Ç—ã:**
```swift
profitInCash = -50 √ó 1 = -50‚ÇΩ
netContribution = 100 - 0 = 100‚ÇΩ
bankOwes = -50 + 100 = 50‚ÇΩ
playerOwes = –ø—Ä–æ–≤–µ—Ä–∫–∞... ‚Üí bankOwes > 0 ‚Üí 0‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –ë–æ–±—É **50‚ÇΩ** (–ø–µ—Ä–µ–ø–ª–∞—Ç–∞)

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –ë–æ–± –¥–æ–ª–∂–µ–Ω –±—ã–ª –≤–Ω–µ—Å—Ç–∏ 50‚ÇΩ, –Ω–æ –≤–Ω—ë—Å 100‚ÇΩ. –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ä–∞–∑–Ω–∏—Ü—É 50‚ÇΩ.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π C: –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π —á–∞—Å—Ç–∏—á–Ω–æ –ø–ª–∞—Ç–∏—Ç

**–ò–≥—Ä–æ–∫: –ß–∞—Ä–ª–∏**
- BuyIn: 100 —Ñ–∏—à–µ–∫
- CashOut: 50 —Ñ–∏—à–µ–∫
- Profit: -50 —Ñ–∏—à–µ–∫
- chipToCashRatio: 1

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ß–∞—Ä–ª–∏ –≤–Ω–æ—Å–∏—Ç –≤ –±–∞–Ω–∫: 30‚ÇΩ

**–†–∞—Å—á—ë—Ç—ã:**
```swift
profitInCash = -50 √ó 1 = -50‚ÇΩ
netContribution = 30 - 0 = 30‚ÇΩ
bankOwes = -50 + 30 = -20‚ÇΩ ‚Üí max(-20, 0) = 0‚ÇΩ
playerOwes = -(-50) - 30 = 50 - 30 = 20‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –ß–∞—Ä–ª–∏: **0‚ÇΩ**
- –ß–∞—Ä–ª–∏ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É: **20‚ÇΩ**

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –ß–∞—Ä–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–ª 50‚ÇΩ, –Ω–æ –≤–Ω—ë—Å —Ç–æ–ª—å–∫–æ 30‚ÇΩ. –ï–º—É –µ—â—ë –Ω—É–∂–Ω–æ –¥–æ–ø–ª–∞—Ç–∏—Ç—å 20‚ÇΩ.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π D: –í—ã–∏–≥—Ä–∞–≤—à–∏–π –ø–æ–ª—É—á–∞–µ—Ç –≤—ã–ø–ª–∞—Ç—ã

**–ò–≥—Ä–æ–∫: –î–∏–∞–Ω–∞**
- BuyIn: 100 —Ñ–∏—à–µ–∫
- CashOut: 150 —Ñ–∏—à–µ–∫
- Profit: +50 —Ñ–∏—à–µ–∫
- chipToCashRatio: 1

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–∏–∞–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç –∏–∑ –±–∞–Ω–∫–∞: 20‚ÇΩ

**–†–∞—Å—á—ë—Ç—ã:**
```swift
profitInCash = 50 √ó 1 = 50‚ÇΩ
netContribution = 0 - 20 = -20‚ÇΩ
bankOwes = 50 + (-20) = 30‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –î–∏–∞–Ω–µ **30‚ÇΩ** (–µ—â—ë –æ—Å—Ç–∞–ª–æ—Å—å –≤—ã–ø–ª–∞—Ç–∏—Ç—å)

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –î–∏–∞–Ω–∞ –≤—ã–∏–≥—Ä–∞–ª–∞ 50‚ÇΩ, —É–∂–µ –ø–æ–ª—É—á–∏–ª–∞ 20‚ÇΩ. –ë–∞–Ω–∫ –µ—â—ë –¥–æ–ª–∂–µ–Ω –µ–π 30‚ÇΩ.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π E: –í—ã—Å–æ–∫–∏–π chipToCashRatio

**–ò–≥—Ä–æ–∫: –ï–ª–µ–Ω–∞**
- BuyIn: 10 —Ñ–∏—à–µ–∫
- CashOut: 15 —Ñ–∏—à–µ–∫
- Profit: +5 —Ñ–∏—à–µ–∫
- **chipToCashRatio: 100** (1 —Ñ–∏—à–∫–∞ = 100‚ÇΩ)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ï–ª–µ–Ω–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–Ω–æ—Å–∏—Ç

**–†–∞—Å—á—ë—Ç—ã:**
```swift
profitInCash = 5 √ó 100 = 500‚ÇΩ
netContribution = 0 - 0 = 0‚ÇΩ
bankOwes = 500 + 0 = 500‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –ï–ª–µ–Ω–µ **500‚ÇΩ**

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** –î–∞–∂–µ –Ω–µ–±–æ–ª—å—à–æ–π –≤—ã–∏–≥—Ä—ã—à –≤ 5 —Ñ–∏—à–µ–∫ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ 500‚ÇΩ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–µ.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π F: –ù–µ—Å–∫–æ–ª—å–∫–æ —Ü–∏–∫–ª–æ–≤ –≤—Ö–æ–¥-–≤—ã—Ö–æ–¥

**–ò–≥—Ä–æ–∫: –§—ë–¥–æ—Ä**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
  1. BuyIn: 100 —Ñ–∏—à–µ–∫
  2. CashOut: 150 —Ñ–∏—à–µ–∫
  3. Rebuy: 50 —Ñ–∏—à–µ–∫
  4. CashOut: 80 —Ñ–∏—à–µ–∫
- chipToCashRatio: 1

**–ò—Ç–æ–≥–æ–≤—ã–π profit:**
```
Total buyIn = 100 + 50 = 150 —Ñ–∏—à–µ–∫
Total cashOut = 150 + 80 = 230 —Ñ–∏—à–µ–∫
Profit = 230 - 150 = +80 —Ñ–∏—à–µ–∫ ‚Üí +80‚ÇΩ
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –§—ë–¥–æ—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –≤–Ω–æ—Å–∏—Ç

**–†–∞—Å—á—ë—Ç—ã:**
```swift
profitInCash = 80 √ó 1 = 80‚ÇΩ
netContribution = 0‚ÇΩ
bankOwes = 80 + 0 = 80‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –§—ë–¥–æ—Ä—É **80‚ÇΩ**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π G: –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ cash-out

**–ò–≥—Ä–æ–∫: –ì–µ–æ—Ä–≥–∏–π**

**–î–æ —É–¥–∞–ª–µ–Ω–∏—è:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: [buyIn(100), cashOut(150)]
- player.inGame = false
- Profit = +50‚ÇΩ ‚Üí –±–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω 50‚ÇΩ

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç cashOut(150):**

**–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: [buyIn(100)]
- player.inGame = true ‚úì (–≤–µ—Ä–Ω—É–ª—Å—è –≤ –∏–≥—Ä—É)
- player.cashOut = 0
- Profit = 0 - 100 = -100‚ÇΩ
- –ë–æ–ª—å—à–µ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö expectedTotal (–≤ –∏–≥—Ä–µ)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–µ–æ—Ä–≥–∏–π —Å–Ω–æ–≤–∞ –∞–∫—Ç–∏–≤–µ–Ω, –µ–≥–æ –¥–æ–ª–≥–∏/–≤—ã–∏–≥—Ä—ã—à–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ–∫–∞ –æ–Ω –≤ –∏–≥—Ä–µ.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π H: –ü–æ–ª–Ω–∞—è —Å–µ—Å—Å–∏—è —Å 4 –∏–≥—Ä–æ–∫–∞–º–∏

**chipToCashRatio = 1**

| –ò–≥—Ä–æ–∫ | buyIn | cashOut | Profit | Deposited | Withdrawn | –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω | –ò–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω |
|-------|-------|---------|--------|-----------|-----------|-------------|--------------|
| –ê–Ω–Ω–∞  | 100   | 200     | +100‚ÇΩ  | 0‚ÇΩ        | 0‚ÇΩ        | **100‚ÇΩ**    | 0‚ÇΩ           |
| –ë–æ—Ä–∏—Å | 100   | 50      | -50‚ÇΩ   | 30‚ÇΩ       | 0‚ÇΩ        | 0‚ÇΩ          | **20‚ÇΩ**      |
| –í–µ—Ä–∞  | 100   | 50      | -50‚ÇΩ   | 100‚ÇΩ      | 0‚ÇΩ        | **50‚ÇΩ**     | 0‚ÇΩ           |
| –ì–ª–µ–±  | 100   | 100     | 0‚ÇΩ     | 0‚ÇΩ        | 0‚ÇΩ        | 0‚ÇΩ          | 0‚ÇΩ           |

**SessionBank –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ü–æ–ª—É—á–µ–Ω–æ –æ—Ç –∏–≥—Ä–æ–∫–æ–≤: 130‚ÇΩ
- –í—ã–¥–∞–Ω–æ –∏–≥—Ä–æ–∫–∞–º: 0‚ÇΩ
- –ë–∞–ª–∞–Ω—Å –±–∞–Ω–∫–∞: 130‚ÇΩ
- –î–æ–ª–∂–Ω—ã –±–∞–Ω–∫—É: 20‚ÇΩ (–ë–æ—Ä–∏—Å)
- –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω: 150‚ÇΩ (–ê–Ω–Ω–∞ 100‚ÇΩ + –í–µ—Ä–∞ 50‚ÇΩ)

**Settlement –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã:**
- –ë–æ—Ä–∏—Å ‚Üí –ê–Ω–Ω–∞: 50‚ÇΩ
- –í–µ—Ä–∞ ‚Üí –ê–Ω–Ω–∞: 50‚ÇΩ

**–†–∞–∑–Ω–∏—Ü–∞:** SessionBank –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã (–í–µ—Ä–∞ –≤–Ω–µ—Å–ª–∞ 100‚ÇΩ), Settlement –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∏—Ö –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã.

---

## SessionBank vs Settlement - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

### –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–ª–∏—á–∏–π

| –ê—Å–ø–µ–∫—Ç | SessionBank | Settlement |
|--------|-------------|------------|
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ | –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã |
| **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** | Chip results + cash deposits/withdrawals | –¢–æ–ª—å–∫–æ chip results |
| **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** | –ö—Ç–æ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É, –∫–æ–º—É –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫ | –ö—Ç–æ –∫–æ–º—É –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å |
| **–£—á–∏—Ç—ã–≤–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç—ã?** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| **–£—á–∏—Ç—ã–≤–∞–µ—Ç withdrawals?** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| **–§–∏–∑–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å** | ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç `netBalance` | ‚ùå –ù–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç |
| **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤** | ‚ùå –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç | ‚úÖ –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–æ–ª-–≤–æ |
| **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** | –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ | –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ |

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

**SessionBank:**
- –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥ –≤ –±–∞–Ω–∫–µ
- –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫—Ç–æ –µ—â—ë –Ω–µ –≤–Ω—ë—Å –¥–µ–Ω—å–≥–∏
- –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–º—É –Ω—É–∂–Ω–æ –≤—ã–ø–ª–∞—Ç–∏—Ç—å
- –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –±–∞–ª–∞–Ω—Å–æ–º –±–∞–Ω–∫–∞

**Settlement:**
- –î–ª—è —Ä–∞—Å—á—ë—Ç–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- –î–ª—è –ø–æ–∫–∞–∑–∞ ¬´–∫—Ç–æ –∫–æ–º—É –¥–æ–ª–∂–µ–Ω¬ª –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±–∞–Ω–∫–∞
- –î–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ –±–µ–∑ —É—á–∞—Å—Ç–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –±–∞–Ω–∫–∞

### –ü—Ä–∏–º–µ—Ä —Ä–∞–∑–ª–∏—á–∏—è

**–°–∏—Ç—É–∞—Ü–∏—è:**
- –í–∞—Å—è –≤—ã–∏–≥—Ä–∞–ª 100‚ÇΩ
- –ü–µ—Ç—è –ø—Ä–æ–∏–≥—Ä–∞–ª 50‚ÇΩ
- –ö–æ–ª—è –ø—Ä–æ–∏–≥—Ä–∞–ª 50‚ÇΩ

**SessionBank:**
```
–ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω: –í–∞—Å—è (100‚ÇΩ)
–î–æ–ª–∂–Ω—ã –±–∞–Ω–∫—É: –ü–µ—Ç—è (50‚ÇΩ), –ö–æ–ª—è (50‚ÇΩ)
```

**Settlement:**
```
–ü–µ—Ä–µ–≤–æ–¥—ã:
- –ü–µ—Ç—è ‚Üí –í–∞—Å—è: 50‚ÇΩ
- –ö–æ–ª—è ‚Üí –í–∞—Å—è: 50‚ÇΩ
```

**–ï—Å–ª–∏ –ü–µ—Ç—è –≤–Ω—ë—Å 100‚ÇΩ –≤ –±–∞–Ω–∫:**

**SessionBank:**
```
–ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω: –í–∞—Å—è (100‚ÇΩ), –ü–µ—Ç—è (50‚ÇΩ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞)
–î–æ–ª–∂–Ω—ã –±–∞–Ω–∫—É: –ö–æ–ª—è (50‚ÇΩ)
–ë–∞–ª–∞–Ω—Å –±–∞–Ω–∫–∞: 100‚ÇΩ
```

**Settlement:** (–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –¥–µ–ø–æ–∑–∏—Ç—ã)
```
–ü–µ—Ä–µ–≤–æ–¥—ã:
- –ü–µ—Ç—è ‚Üí –í–∞—Å—è: 50‚ÇΩ
- –ö–æ–ª—è ‚Üí –í–∞—Å—è: 50‚ÇΩ
```

---

## Settlement: –†–∞—Å—á—ë—Ç—ã –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏

### –ó–∞–¥–∞—á–∞ SettlementService
–†–∞—Å—Å—á–∏—Ç–∞—Ç—å **–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤** –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏.

### PlayerBalance
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏–≥—Ä–æ–∫–∞:

```swift
struct PlayerBalance {
    let player: Player
    let buyIn: Int       // –§–∏—à–∫–∏
    let cashOut: Int     // –§–∏—à–∫–∏
    let netChips: Int    // –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∏—à–∫–∞—Ö (cashOut - buyIn)
    let netCash: Int     // –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ä—É–±–ª—è—Ö (netChips √ó chipToCashRatio)
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á—ë—Ç–∞

```swift
func calculate(for session: Session) -> SettlementResult {
    var balances: [PlayerBalance] = []

    // –®–∞–≥ 1: –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    for player in session.players {
        let buyIn = player.buyIn
        let cashOut = player.cashOut
        let netChips = cashOut - buyIn
        let netCash = netChips * session.chipToCashRatio

        balances.append(PlayerBalance(
            player: player,
            buyIn: buyIn,
            cashOut: cashOut,
            netChips: netChips,
            netCash: netCash
        ))
    }

    // –®–∞–≥ 2: –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –¥–æ–ª–∂–Ω–∏–∫–æ–≤ –∏ –∫—Ä–µ–¥–∏—Ç–æ—Ä–æ–≤ (–≤ cash)
    let debtors = balances.filter { $0.netCash < 0 }    // –î–æ–ª–∂–Ω—ã –∑–∞–ø–ª–∞—Ç–∏—Ç—å
    let creditors = balances.filter { $0.netCash > 0 }  // –î–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å

    // –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã (–≤ —Ä—É–±–ª—è—Ö)
    var transfers: [Transfer] = []
    // ... greedy algorithm –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

    return SettlementResult(balances: balances, transfers: transfers)
}
```

### Transfer (–ü–µ—Ä–µ–≤–æ–¥)
–í—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏ –≤ **—Ä—É–±–ª—è—Ö**:

```swift
struct Transfer {
    let from: Player  // –ö—Ç–æ –ø–ª–∞—Ç–∏—Ç
    let to: Player    // –ö—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç
    let amount: Int   // –°—É–º–º–∞ –≤ –†–£–ë–õ–Ø–•
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `chipToCashRatio = 1` (1 —Ñ–∏—à–∫–∞ = 1 —Ä—É–±–ª—å)

**–ò–≥—Ä–æ–∫ –í–∞—Å—è:**
- BuyIn: 100 —Ñ–∏—à–µ–∫
- CashOut: 150 —Ñ–∏—à–µ–∫
- Profit (chips): +50 —Ñ–∏—à–µ–∫
- Profit (cash): +50‚ÇΩ

**SessionBank:**
- Expected from –í–∞—Å—è: 0‚ÇΩ (–æ–Ω –≤ –ø–ª—é—Å–µ)
- –í–∞—Å—è –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–ª–∂–µ–Ω –±–∞–Ω–∫—É

**Settlement:**
- –í–∞—Å—è –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å 50‚ÇΩ –æ—Ç –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤

---

### –ü—Ä–∏–º–µ—Ä 2: –ò–≥—Ä–æ–∫ —Å –ø–µ—Ä–µ–ø–ª–∞—Ç–æ–π

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `chipToCashRatio = 1` (1 —Ñ–∏—à–∫–∞ = 1 —Ä—É–±–ª—å)

**–ò–≥—Ä–æ–∫ –í–∞—Å—è:**
- BuyIn: 200 —Ñ–∏—à–µ–∫ (PlayerTransaction)
- CashOut: 150 —Ñ–∏—à–µ–∫ (PlayerTransaction)
- Profit (chips): -50 —Ñ–∏—à–µ–∫
- Expected debt (cash): 50‚ÇΩ

**SessionBank —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
- Deposit: 1000‚ÇΩ (–≤–Ω—ë—Å –≤ –±–∞–Ω–∫)

**SessionBank —Ä–∞—Å—á—ë—Ç—ã:**
```swift
chipBalance = 200 - 150 = 50 —Ñ–∏—à–µ–∫ (–¥–æ–ª–∂–µ–Ω)
expectedCash = 50 √ó 1 = 50‚ÇΩ
deposited = 1000‚ÇΩ
outstanding = max(50 - 1000, 0) = 0‚ÇΩ
overpayment = max(1000 - 50, 0) = 950‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í–∞—Å—è –ø–µ—Ä–µ–ø–ª–∞—Ç–∏–ª 950‚ÇΩ
- –ë–∞–Ω–∫ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –µ–º—É 950‚ÇΩ

---

### –ü—Ä–∏–º–µ—Ä 3: –ö—É—Ä—Å 1 —Ñ–∏—à–∫–∞ = 10 —Ä—É–±–ª–µ–π

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `chipToCashRatio = 10` (1 —Ñ–∏—à–∫–∞ = 10 —Ä—É–±–ª–µ–π)

**–ò–≥—Ä–æ–∫ –ü–µ—Ç—è:**
- BuyIn: 100 —Ñ–∏—à–µ–∫
- CashOut: 50 —Ñ–∏—à–µ–∫
- Profit (chips): -50 —Ñ–∏—à–µ–∫
- Profit (cash): -500‚ÇΩ

**SessionBank:**
```swift
chipBalance = 100 - 50 = 50 —Ñ–∏—à–µ–∫ (–¥–æ–ª–∂–µ–Ω)
expectedCash = 50 √ó 10 = 500‚ÇΩ
```

**SessionBank —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
- Deposit: 200‚ÇΩ (–≤–Ω—ë—Å –≤ –±–∞–Ω–∫)

**SessionBank —Ä–∞—Å—á—ë—Ç—ã:**
```swift
outstanding = max(500 - 200, 0) = 300‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–µ—Ç—è –¥–æ–ª–∂–µ–Ω –≤–Ω–µ—Å—Ç–∏ –µ—â—ë 300‚ÇΩ –≤ –±–∞–Ω–∫

---

### –ü—Ä–∏–º–µ—Ä 4: –ü–æ–ª–Ω–∞—è —Å–µ—Å—Å–∏—è —Å 3 –∏–≥—Ä–æ–∫–∞–º–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `chipToCashRatio = 1`

| –ò–≥—Ä–æ–∫ | BuyIn (—Ñ–∏—à–∫–∏) | CashOut (—Ñ–∏—à–∫–∏) | Profit (—Ñ–∏—à–∫–∏) | Profit (‚ÇΩ) |
|-------|---------------|-----------------|----------------|-----------|
| –í–∞—Å—è  | 100           | 200             | +100           | +100‚ÇΩ     |
| –ü–µ—Ç—è  | 100           | 50              | -50            | -50‚ÇΩ      |
| –ö–æ–ª—è  | 100           | 50              | -50            | -50‚ÇΩ      |
| **–ò—Ç–æ–≥–æ** | **300**   | **300**         | **0**          | **0‚ÇΩ**    |

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—É–º–º–∞ profit –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ = 0 (closed economy) ‚úì

**SessionBank —Ä–∞—Å—á—ë—Ç—ã:**
- Expected from –ü–µ—Ç—è: 50‚ÇΩ
- Expected from –ö–æ–ª—è: 50‚ÇΩ
- Expected total: 100‚ÇΩ

**Settlement –ø–µ—Ä–µ–≤–æ–¥—ã (–≤ —Ä—É–±–ª—è—Ö):**
1. –ü–µ—Ç—è ‚Üí –í–∞—Å—è: 50‚ÇΩ
2. –ö–æ–ª—è ‚Üí –í–∞—Å—è: 50‚ÇΩ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∞—Å—è –ø–æ–ª—É—á–∏—Ç 100‚ÇΩ (—Å–≤–æ–π –≤—ã–∏–≥—Ä—ã—à)

---

### –ü—Ä–∏–º–µ—Ä 5: –°—Ü–µ–Ω–∞—Ä–∏–π —Å —Ä–∞–∑–Ω—ã–º –∫—É—Ä—Å–æ–º

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `chipToCashRatio = 100` (1 —Ñ–∏—à–∫–∞ = 100 —Ä—É–±–ª–µ–π)

**–ò–≥—Ä–æ–∫ –î–∏–º–∞:**
- BuyIn: 10 —Ñ–∏—à–µ–∫ (game amount)
- CashOut: 5 —Ñ–∏—à–µ–∫
- Profit (chips): -5 —Ñ–∏—à–µ–∫
- Profit (cash): -500‚ÇΩ

**SessionBank:**
```swift
chipBalance = 10 - 5 = 5 —Ñ–∏—à–µ–∫
expectedCash = 5 √ó 100 = 500‚ÇΩ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–∏–º–∞ –¥–æ–ª–∂–µ–Ω –≤–Ω–µ—Å—Ç–∏ 500‚ÇΩ –≤ –±–∞–Ω–∫

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

```mermaid
graph LR
    subgraph Chip Economy
        PT[PlayerTransaction]
        P[Player.profit]
    end

    subgraph Conversion
        R[chipToCashRatio]
    end

    subgraph Cash Economy
        SBT[SessionBankTransaction]
        EXP[Expense]
        SET[Settlement.Transfer]
    end

    P -->|√ó chipToCashRatio| R
    R -->|expectedCash| SBT
    R -->|netCash| SET
```

---

## –ü—Ä–∞–≤–∏–ª–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI

### PlayerRow (–°—Ç—Ä–æ–∫–∞ –∏–≥—Ä–æ–∫–∞ –≤ —Å–ø–∏—Å–∫–µ)
- **buyIn**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∏—à–∫–∞—Ö, –ë–ï–ó `.asCurrency()`
- **cashOut**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∏—à–∫–∞—Ö, –ë–ï–ó `.asCurrency()`
- **profit**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∏—à–∫–∞—Ö, –ë–ï–ó `.asCurrency()`
- –§–æ—Ä–º–∞—Ç: `+50` –∏–ª–∏ `-30` (–ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ —Å –∑–Ω–∞–∫–æ–º)

### ChipsStatsSection (–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏—à–µ–∫ —Å–µ—Å—Å–∏–∏)
- **totalChips**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∏—à–∫–∞—Ö, –ë–ï–ó `.asCurrency()`
- **chipsInGame**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∏—à–∫–∞—Ö, –ë–ï–ó `.asCurrency()`
- **chipsWithdrawn**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∏—à–∫–∞—Ö, –ë–ï–ó `.asCurrency()`
- –§–æ—Ä–º–∞—Ç: `150 —Ñ–∏—à–µ–∫` –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ `150`

### SessionBankView (–≠–∫—Ä–∞–Ω –±–∞–Ω–∫–∞)
- **expectedTotal**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ä—É–±–ª—è—Ö, –° `.asCurrency()`
- **totalDeposited**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ä—É–±–ª—è—Ö, –° `.asCurrency()`
- **remainingToCollect**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ä—É–±–ª—è—Ö, –° `.asCurrency()`
- **overpaymentTotal**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ä—É–±–ª—è—Ö, –° `.asCurrency()`

### SettlementView (–≠–∫—Ä–∞–Ω —Ä–∞—Å—á—ë—Ç–æ–≤)
- **Player balance**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å chip —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ò cash —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  - –§–æ—Ä–º–∞—Ç: `–í–∞—Å—è: -50 —Ñ–∏—à–µ–∫ (-500‚ÇΩ)`
- **Transfers**: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¢–û–õ–¨–ö–û –≤ —Ä—É–±–ª—è—Ö
  - –§–æ—Ä–º–∞—Ç: `–ü–µ—Ç—è ‚Üí –í–∞—Å—è: 500‚ÇΩ`

---

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **Chip Economy** = –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ (buy-in, cash-out, profit)
2. **Cash Economy** = —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ (–±–∞–Ω–∫, —Ä–∞—Å—Ö–æ–¥—ã, –ø–µ—Ä–µ–≤–æ–¥—ã)
3. **chipToCashRatio** = –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ—Å—Ç –º–µ–∂–¥—É —ç–∫–æ–Ω–æ–º–∏–∫–∞–º–∏
4. **SessionBank** —Ä–∞–±–æ—Ç–∞–µ—Ç —Å cash, –Ω–æ –ö–û–ù–í–ï–†–¢–ò–†–£–ï–¢ chip —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–≤
5. **Settlement** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã –¢–û–õ–¨–ö–û –≤ cash
6. **UI**: PlayerRow = chips, SessionBankView = cash

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω**: 29 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0
